#                         Filtering method


## 基于STM32H743阿波罗开发板滤波法
- 1L_F_M------->限幅滤波法  
				A、方法：  
					根据经验判断，确定两次采样允许的最大偏差值（设为A），  
					每次检测到新值时判断：  
					如果本次值与上次值之差<=A，则本次值有效，  
					如果本次值与上次值之差>A，则本次值无效，放弃本次值，用上次值代替本次值。  
				B、优点：  
					能有效克服因偶然因素引起的脉冲干扰。  
				C、缺点：  
					无法抑制那种周期性的干扰。  
					平滑度差。  
					
- 2M_F_M------->中位滤波法  
				A、方法：  
					连续采样N次（N取奇数），把N次采样值按大小排列，  
					取中间值为本次有效值。  
				B、优点：  
					能有效克服因偶然因素引起的波动干扰；  
					对温度、液位的变化缓慢的被测参数有良好的滤波效果。  
				C、缺点：  
					对流量、速度等快速变化的参数不宜  
- 3A_M_F_M----->算数平均滤波法  
				A、方法：  
					连续取N个采样值进行算术平均运算：  
					N值较大时：信号平滑度较高，但灵敏度较低；  
					N值较小时：信号平滑度较低，但灵敏度较高；  
					N值的选取：一般流量，N=12；压力：N=4。  
				B、优点：  
					适用于对一般具有随机干扰的信号进行滤波；  
					这种信号的特点是有一个平均值，信号在某一数值范围附近上下波动。  
				C、缺点：  
					对于测量速度较慢或要求数据计算速度较快的实时控制不适用；  
					比较浪费RAM。  
- 4R_A_F_M----->递推平均滤波法  
				A、方法：  
					把连续取得的N个采样值看成一个队列，队列的长度固定为N，  
					每次采样到一个新数据放入队尾，并扔掉原来队首的一次数据（先进先出原则），  
					把队列中的N个数据进行算术平均运算，获得新的滤波结果。  
					N值的选取：流量，N=12；压力，N=4；液面，N=4-12；温度，N=1-4。  
				B、优点：  
					对周期性干扰有良好的抑制作用，平滑度高；  
					适用于高频振荡的系统。  
				C、缺点：  
					灵敏度低，对偶然出现的脉冲性干扰的抑制作用较差；  
					不易消除由于脉冲干扰所引起的采样值偏差；  
					不适用于脉冲干扰比较严重的场合；  
					比较浪费RAM。  
- 5M_F_M------->中位值平均滤波法  
				A、方法：  
					采一组队列去掉最大值和最小值后取平均值，  
					相当于“中位值滤波法”+“算术平均滤波法”。  
					连续采样N个数据，去掉一个最大值和一个最小值，  
					然后计算N-2个数据的算术平均值。  
					N值的选取：3-14。  
				B、优点：  
					融合了“中位值滤波法”+“算术平均滤波法”两种滤波法的优点。  
					对于偶然出现的脉冲性干扰，可消除由其所引起的采样值偏差。  
					对周期干扰有良好的抑制作用。  
					平滑度高，适于高频振荡的系统。  
				C、缺点：  
					计算速度较慢，和算术平均滤波法一样。  
					比较浪费RAM。  
- 6L_A_F_M----->限幅平均滤波法  
				A、方法：  
					相当于“限幅滤波法”+“递推平均滤波法”；  
					每次采样到的新数据先进行限幅处理，  
					再送入队列进行递推平均滤波处理。  
				B、优点：  
					融合了两种滤波法的优点；  
					对于偶然出现的脉冲性干扰，可消除由于脉冲干扰所引起的采样值偏差。  
				C、缺点：  
					比较浪费RAM。  
- 7F_O_L_F_M--->一阶滞后滤波法  
				A、方法：  
					取a=0-1，本次滤波结果=(1-a)*本次采样值+a*上次滤波结果。  
				B、优点：  
					对周期性干扰具有良好的抑制作用；  
					适用于波动频率较高的场合。  
				C、缺点：  
					相位滞后，灵敏度低；  
					滞后程度取决于a值大小；  
					不能消除滤波频率高于采样频率1/2的干扰信号。  
- 8W_R_A_F_M--->加权递推平均滤波法  
				A、方法：  
					是对递推平均滤波法的改进，即不同时刻的数据加以不同的权；  
					通常是，越接近现时刻的数据，权取得越大。  
					给予新采样值的权系数越大，则灵敏度越高，但信号平滑度越低。  
				B、优点：  
					适用于有较大纯滞后时间常数的对象，和采样周期较短的系统。  
				C、缺点：  
					对于纯滞后时间常数较小、采样周期较长、变化缓慢的信号；  
					不能迅速反应系统当前所受干扰的严重程度，滤波效果差。  
- 9B_F_M------->消抖滤波法  
				A、方法：  
					设置一个滤波计数器，将每次采样值与当前有效值比较：  
					如果采样值=当前有效值，则计数器清零；  
					如果采样值<>当前有效值，则计数器+1，并判断计数器是否>=上限N（溢出）；  
					如果计数器溢出，则将本次值替换当前有效值，并清计数器。  
				B、优点：  
					对于变化缓慢的被测参数有较好的滤波效果；  
					可避免在临界值附近控制器的反复开/关跳动或显示器上数值抖动。  
				C、缺点：  
					对于快速变化的参数不宜；  
					如果在计数器溢出的那一次采样到的值恰好是干扰值,则会将干扰值当作有效值导入系统。  
- 10L_B_F_M---->限幅消抖滤波法  
				A、方法：  
					相当于“限幅滤波法”+“消抖滤波法”；  
					先限幅，后消抖。  
				B、优点：  
					继承了“限幅”和“消抖”的优点；  
					改进了“消抖滤波法”中的某些缺陷，避免将干扰值导入系统。  
				C、缺点：  
					对于快速变化的参数不宜。  
- 11K_F_M----->卡尔曼滤波法  

# STM32H743-atk-apollo 开发板 BSP 说明

## 简介

本文档为 whj4674672 为 STM32H743-atk-apollo 开发板提供的 BSP (板级支持包) 说明。

主要内容如下：

- 开发板资源介绍
- 进阶使用方法

通过阅读快速上手章节开发者可以快速地上手该 BSP，将 RT-Thread 运行在开发板上。在进阶使用指南章节，将会介绍更多高级功能，帮助开发者利用 RT-Thread 驱动更多板载资源。

## 开发板介绍

阿波罗 STM32H743 是正点原子推出的一款基于 ARM Cortex-M7 内核的开发板，最高主频为 400Mhz，该开发板具有丰富的板载资源，可以充分发挥 STM32H743 的芯片性能。

开发板外观如下图所示：

![board](figures/board.jpg)

该开发板常用 **板载资源** 如下：

- MCU：STM32H743，主频 400MHz，2MB FLASH ，1MB RAM
- 外部 SDRAM：W9825G6KH，32MB
- 外部 NAND FLASH：H27U4G8F2，512MB
- 外部 QSPI FLASH：W25Q256，32MB
- 常用外设
  - LED：2个，DS0（红色，PB1），DS1（绿色，PB0）
  - 按键：4个，KEY_UP（兼具唤醒功能，PA0），K0（PH3），K1（PH2），K2（PC13）
- 常用接口：USB 转串口、SD 卡接口、以太网接口、LCD 接口等
- 调试接口，标准 JTAG/SWD

开发板更多详细信息请参考正点原子 [STM32阿波罗开发板介绍](http://www.openedv.com/docs/boards/stm32/zdyz_stm32h743_apollo.html)。

## 外设支持

本 BSP 目前对外设的支持情况如下：

| **板载外设**      | **支持情况** | **备注**                              |
| :----------------- | :----------: | :------------------------------------- |
| USB 转串口        |     支持     |                                       |
| QSPI Flash        |     支持     |                                       |
| 以太网            |   暂不支持   |                                       |
| SD卡              |   暂不支持   |                                       |
| CAN               |   暂不支持   |                                       |
| SDRAM             |     支持     |                                       |
| LCD               |     支持     |                                       |
| MPU9250六轴传感器 |   暂不支持   |                                       |
| **片上外设**      | **支持情况** | **备注**                              |
| GPIO              |     支持     | PA0, PA1... PK15 ---> PIN: 0, 1...176 |
| UART              |     支持     |                                       |
| SPI               |   支持   | SPI2 |
| I2C               |   暂不支持   |                                       |
| SDIO              |   暂不支持   |                                       |
| RTC               |     支持     |                                       |
| PWM               |   暂不支持   |                                       |
| USB Device        |   暂不支持   |                                       |
| USB Host          |   暂不支持   |                                       |
| IWG               |     支持     |                                       |


### 硬件连接

使用数据线连接开发板到 PC，打开电源开关。

#### 编译下载

双击 project.uvprojx 文件，打开 MDK5 工程，编译并下载程序到开发板。

> 工程默认配置使用 ST_LINK 仿真器下载程序，在通过 ST_LINK 连接开发板的基础上，点击下载按钮即可下载程序到开发板

## 注意事项

暂无

## 联系人信息

维护人:

 [whj4674672](https://github.com/whj4674672), 邮箱：<whj4674672@163.com>

